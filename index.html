<!DOCTYPE html>
<html>
<head>
  <title>座標当てゲーム</title>
  <style>
    body {
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-family: Arial, sans-serif;
    }
    #coordinates {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
    }

    #map {
      position: relative; /* 追加: マップを相対的な位置に設定する */

			margin: 0 auto;
			user-drag: none;
			-webkit-user-drag: none;
			-moz-user-select: none;
    }

    #rd-button {
      position: relative; /* 追加 */
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
			display: none;
      padding: 10px;
      display: none;
      border: none;
      cursor: pointer;
    }
    #ok-button {
      position: relative; /* 追加 */
      top: 0px;
      left: 50%;
      transform: translateX(-50%);
			display: none;
      padding: 10px;
      background-color: #f44336;
      color: white;
      border: none;
      cursor: pointer;
    }
		
    #ok-button:hover {
			background-color: #d32f2f;
    }
		#container {
      text-align: center;
      position: relative; /* 追加 */
      justify-content: center; /* 追加 */
      justify-content: space-between; /* 追加 */

		}
		
    .hidden {
      display: none;
    }
    .circle {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: red;
    }
    .Truecircle {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 20%;
      background-color: blue;
    }
  </style>
</head>
<body>
	
	<div id="container">
		<img id="map" src="map.png" alt="マップ">

		<h2 id="randomData"></h2>
		<h2 id="message">この建物の座標はどこでしょう？</h2>
		<div id="coordinates"></div>
		<button id="ok-button">特定した！</button>
		<br>
		<button id="rd-button" onclick="getRandomElement()">次の問題へ</button>
	</div>
  <script>
    var x,y;
		var Tx,Ty;
    function getRandomElement() {
      fetch('coords.json') 

			.then(response => response.json())
				.then(jsonList => {
					var length = jsonList.length;
					var randomIndex = Math.floor(Math.random() * length);
					var randomElement = jsonList[randomIndex];
					document.getElementById("randomData").innerHTML = randomElement.place;
					Tx = randomElement.x;
					Ty = randomElement.z;
				})
				.catch(error => {
				console.error('Error:', error);
			});
      if (circleElement) {
          circleElement.remove();
      }
		}
		window.onload = getRandomElement;

    document.addEventListener('DOMContentLoaded', function() {
      var coordinatesElement = document.getElementById('coordinates');
      var mapElement = document.getElementById('map');
			var Message = document.getElementById('message');
			var okButton = document.getElementById('ok-button');
			var rdButton = document.getElementById('rd-button');
      var container = document.getElementById('container');
      var circleElement = document.createElement('div');
      var TruecircleElement = document.createElement('div');

    document.addEventListener('click', function(event) {
    var rect = mapElement.getBoundingClientRect();
    var containerWidth = rect.width;
    var containerHeight = rect.height;
    x = Math.floor((event.clientX - rect.left) / containerWidth * 512) - 448;
    y = Math.floor((event.clientY - rect.top) / containerHeight * 512) - 704;
    if (x >= -448 && x <= 64 && y >= -704 && y <= -192) {
        coordinatesElement.textContent = 'X座標: ' + x + ', Z座標: ' + y;
        Message.classList.add('hidden');
        okButton.style.display = 'block';
        if (circleElement) {
          circleElement.remove();
        }
          circleElement.classList.add('circle');
          circleElement.style.left = (event.clientX - 5 - rect.left) + 'px'; /* 変更: マップ要素の位置を考慮する */
          circleElement.style.top = (event.clientY - 5 - rect.top) + 'px'; /* 変更: マップ要素の位置を考慮する */
          container.appendChild(circleElement);
        }
    });
			
		okButton.addEventListener('click', function() {
        var dist = Math.floor(Math.sqrt((Tx - x) * (Tx - x) + (Ty - y) * (Ty - y)));
        alert('誤差は ' + dist + ' mです．正解はx=' + Tx + ',z=' + Ty);
        TruecircleElement.classList.add('Truecircle');
        TruecircleElement.style.left = Tx - 448 + 'px';
        TruecircleElement.style.top = Ty - 704 + 'px';
        container.appendChild(TruecircleElement);
        rdButton.style.display = 'block';
      });
    });

  </script>
</body>
</html>
